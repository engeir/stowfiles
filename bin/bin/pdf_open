#!/usr/bin/env bash

#
# Search through and open any file matching pattern *.pdf inside directories:
#

if [[ $(uname -s) == "Darwin" ]]; then
    # Mac
    DIR1="/Users/eirikenger/personal-library/"
    DIR2="/Users/eirikenger/Downloads/"
    dmenu="sk"
    open=open
    fd=fd
else
    # Linux
    DIR1="$HOME/Documents/"
    DIR2="$HOME/science/"
    if [[ -n $WAYLAND_DISPLAY ]]; then
        FS="16"
        MONITOR=$(mmsg -go | grep 'selmon 1' | awk '{print $1}')
        WIDTH=$(wlr-randr --json | jq -r ".[] | select(.name == \"$MONITOR\") | .modes[] | select(.current == true) | .width")
        WIDTH=$(("$WIDTH" / FS))
        WIDTH=$((WIDTH < 150 ? WIDTH : 150))
        dmenu=(fuzzel -a bottom -d --dpi-aware=yes -w "$WIDTH" -f "CaskaydiaMono Nerd Font:size=$FS" -l 20 -p "PDF: ")
    else
        dmenu=(dmenu -b -nb "#2d2d2d" -nf "#7070c2" -sb "#8c8cd0" -sf "#2d2d2d" -l 20 -fn "CaskaydiaMono Nerd Font")
    fi
    open=xdg-open
    fd=fd
fi

cd ~ || exit 1
c=$("$fd" -I . -e 'pdf' "$DIR1" "$DIR2" | grep -o ".*pdf$" | awk -F'/' '{print $NF}' | "${dmenu[@]}")

# Exit if none is chosen
[ "$c" = "" ] && exit

DIR=$("$fd" -I -H "$c" "$DIR1" "$DIR2" | sed 1q)

# Open with default
"$open" "$DIR"
