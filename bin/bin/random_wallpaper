#!/bin/bash

DIR="$HOME/syncthing/wallpapers"

ls "$HOME"/syncthing/wallpapers | sort -R | sed 1q | while read file; do
    # echo $file
    DIR=$(ls ~/syncthing/wallpapers/* | grep "$file")

    # Copy the selected wallpaper to be the main wallpaper
    # cp "$DIR" "$HOME"/.cache/bspwm/wallpaper.jpg
    convert "$DIR" -blur 0x15 "$HOME"/.cache/bspwm/wallpaper.jpg

    # Set the new wallpaper
    if [[ $(uname -s) == "Darwin" ]]; then
        # Mac
        m wallpaper "$DIR"
    else
        # Linux
        feh --bg-fill "$HOME"/.cache/bspwm/wallpaper.jpg
    fi
done
